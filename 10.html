<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>49-Day Study Tracker</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: "Poppins", sans-serif;
      background: #f0f4f8;
      color: #222;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      margin: 0;
    }

    h1 {
      color: #ff4500;
      margin-bottom: 20px;
    }

    .chart-container {
      width: 95%;
      max-width: 900px;
      margin-bottom: 25px;
      background: #fff;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 15px;
      width: 90%;
      max-width: 1100px;
    }

    .day-card {
      background: #fff;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 3px 12px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
      text-align: center;
      border: 3px solid transparent;
    }

    .day-card.completed {
      background: #d1fae5;
      border-color: #10b981;
      text-decoration: line-through;
    }

    .day-card:hover {
      transform: scale(1.04);
    }

    .subject {
      font-weight: 600;
      color: #2563eb;
      margin-top: 5px;
    }

    .lesson {
      color: #7c3aed;
      font-weight: 500;
    }

    button {
      margin-top: 10px;
      background: linear-gradient(90deg,#2563eb,#1e40af);
      color: #fff;
      border: none;
      padding: 8px 14px;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.3s;
    }

    button:hover {
      background: linear-gradient(90deg,#1e3a8a,#1e40af);
    }

    .completed button {
      background: linear-gradient(90deg,#ef4444,#b91c1c);
    }

    @media (max-width: 600px) {
      .grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <h1>ðŸ“˜ 49-Day Study Tracker</h1>

  <div class="chart-container">
    <canvas id="progressChart"></canvas>
  </div>

  <div class="grid" id="dayGrid"></div>

  <script>
    const totalDays = 49;
    const mainSubjects = ["AOR", "FLAT"];
    const extraSubjects = ["DWDM", "CN", "AI"];
    const lessonsPerSubject = 5;

    const completedDays = JSON.parse(localStorage.getItem("completedDays")) || [];
    const progress = JSON.parse(localStorage.getItem("progress")) || {
      AOR: 0, FLAT: 0, DWDM: 0, CN: 0, AI: 0
    };

    const grid = document.getElementById("dayGrid");

    // Start date (Oct 13, 2025)
    const startDate = new Date(2025, 9, 13); // month 0-indexed

    function formatDate(date) {
      const options = { month: 'short', day: 'numeric' };
      return date.toLocaleDateString('en-US', options);
    }

    // Generate 49-day plan
    for (let i = 1; i <= totalDays; i++) {
      const dayCard = document.createElement("div");
      dayCard.classList.add("day-card");

      const block = Math.floor((i - 1) / 3);
      const mainSubject = mainSubjects[block % 2];
      const extraSubject = extraSubjects[(i - 1) % extraSubjects.length];

      const mainLesson = ((Math.floor((i - 1) / 3)) % lessonsPerSubject) + 1;
      const extraLesson = ((i - 1) % lessonsPerSubject) + 1;

      const mainText = (block >= lessonsPerSubject) ? `Revision (Lesson ${mainLesson})` : `Lesson ${mainLesson}`;
      const extraText = (Math.floor((i - 1) / extraSubjects.length) >= lessonsPerSubject) ? `Revision (Lesson ${extraLesson})` : `Lesson ${extraLesson}`;

      const currentDate = new Date(startDate);
      currentDate.setDate(startDate.getDate() + (i - 1));
      const dateText = formatDate(currentDate);

      if (completedDays.includes(i)) dayCard.classList.add("completed");

      dayCard.innerHTML = `
        <h2>Day ${i} - ${dateText}</h2>
        <p><strong>Main:</strong> ${mainSubject}</p>
        <p class="lesson">${mainText}</p>
        <p class="subject"><strong>Extra:</strong> ${extraSubject}</p>
        <p class="lesson">${extraText}</p>
        <button>${completedDays.includes(i) ? "Unmark" : "Mark Complete"}</button>
      `;

      const btn = dayCard.querySelector("button");
      btn.addEventListener("click", () => toggleComplete(i, mainSubject, extraSubject, dayCard, btn));
      grid.appendChild(dayCard);
    }

    function toggleComplete(day, main, extra, card, btn) {
      const index = completedDays.indexOf(day);
      if (index === -1) {
        completedDays.push(day);
        card.classList.add("completed");
        btn.textContent = "Unmark";
        progress[main]++;
        progress[extra]++;
      } else {
        completedDays.splice(index, 1);
        card.classList.remove("completed");
        btn.textContent = "Mark Complete";
        progress[main]--;
        progress[extra]--;
      }

      localStorage.setItem("completedDays", JSON.stringify(completedDays));
      localStorage.setItem("progress", JSON.stringify(progress));
      updateChart();
    }

    // Stacked horizontal bar chart
    const ctx = document.getElementById("progressChart").getContext("2d");
    const maxLessons = lessonsPerSubject * 3; // approximate max per subject

    const chart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ["AOR", "FLAT", "DWDM", "CN", "AI"],
        datasets: [{
          label: 'Completed',
          data: [progress.AOR, progress.FLAT, progress.DWDM, progress.CN, progress.AI],
          backgroundColor: ['#f87171','#fbbf24','#34d399','#60a5fa','#a78bfa'],
          borderRadius: 20,
          barPercentage: 0.6
        },{
          label: 'Remaining',
          data: [
            Math.max(0,maxLessons-progress.AOR),
            Math.max(0,maxLessons-progress.FLAT),
            Math.max(0,maxLessons-progress.DWDM),
            Math.max(0,maxLessons-progress.CN),
            Math.max(0,maxLessons-progress.AI)
          ],
          backgroundColor: '#e5e7eb',
          borderRadius: 20,
          barPercentage: 0.6
        }]
      },
      options: {
        indexAxis: 'y',
        responsive: true,
        plugins: {
          legend: { position: 'top' },
          tooltip: {
            callbacks: {
              label: ctx => `${ctx.dataset.label}: ${ctx.raw} Days`
            }
          }
        },
        scales: {
          x: { stacked: true, beginAtZero:true, max: maxLessons },
          y: { stacked: true }
        }
      }
    });

    function updateChart() {
      chart.data.datasets[0].data = [progress.AOR, progress.FLAT, progress.DWDM, progress.CN, progress.AI];
      chart.data.datasets[1].data = [
        Math.max(0,maxLessons-progress.AOR),
        Math.max(0,maxLessons-progress.FLAT),
        Math.max(0,maxLessons-progress.DWDM),
        Math.max(0,maxLessons-progress.CN),
        Math.max(0,maxLessons-progress.AI)
      ];
      chart.update();
    }

    updateChart();
  </script>
</body>
</html>
